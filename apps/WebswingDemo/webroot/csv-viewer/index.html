<!DOCTYPE html>
<html>
	<head>
		<title>Demo text file viewer</title>
		<meta charset="utf-8">
		<script language="javascript" type="text/javascript">
			const searchParams = new URLSearchParams(window.location.search);
			const blobId = searchParams.get('file');
			console.log("blobId", blobId)
		
			document.addEventListener("DOMContentLoaded", function(event) {
				const operation = searchParams.get('operation');
				if(operation){
					document.getElementById('operation').innerText=operation;
				}
				
				var fileContent = document.getElementById('filecontent');
				fileContent.value = 'Loading file content ...';
				
				fetch(blobId)
				  .then(response => response.blob())
				  .then(blob => {
				    const reader = new FileReader();
				    reader.readAsText(blob);
				    reader.onloadend = function() {
				    	const rows = reader.result.split("\n");

				    	let table = "<table><thead><tr>";
				    	rows[0].split(";").forEach(header => {
				    	  table += `<th>${header}</th>`;
				    	});
				    	table += "</tr></thead><tbody>";

				    	for(let i = 1; i < rows.length; i++) {
				    	  const rowData = rows[i].split(";");
				    	  table += "<tr>";
				    	  rowData.forEach(cell => {
				    	    table += `<td>${cell}</td>`;
				    	  });
				    	  table += "</tr>";
				    	}
				    	table += "</tbody></table>";

				    	document.getElementById("filecontent").innerHTML = table;
				    };
				  })
				  .catch(error => {
					  fileContent.value = "Blob error " + error
					  console.error('blob error', error)
				  });
			});
		</script>
		<style type="text/css">
			table, th, td {
			  border: 1px solid #777;
			  border-collapse: collapse;
			  padding: 4px 7px;
			}
			th {
			  background-color: #bbb;
			}
			tr:nth-child(odd) {
				background-color: #eee;
			}
		</style>
	</head>
	<body>
		<h1>Simple csv file viewer</h1>
		<h3>Operation: <span id="operation" style="background-color: #ddd;">none</span></h3>
		<div id="filecontent" style="white-space: pre"></div>
	</body>
</html>