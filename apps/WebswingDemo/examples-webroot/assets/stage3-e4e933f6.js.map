{"version":3,"file":"stage3-e4e933f6.js","sources":["../../src/stage3.ts"],"sourcesContent":["import './style.css'\nimport '@webswing-migration-frontend/webswing-webcomponents'\nimport { IHtmlWindow, IInjectorApi, IWebswingInstance, IWindowCloseEvent } from 'webswing-api/dist/types';\nimport { getWebswingApi } from 'webswing-api';\nimport { getParam } from './utils';\nimport { WsModal, WsToast, WsTabs, WsTab, WsDetailForm, WsIntro } from '@webswing-migration-frontend/webswing-webcomponents';\nimport { IFormData } from '@webswing-migration-frontend/webswing-webcomponents/dist/ws-detail-form/ws-detail-form';\n\nclass MigrationApp {\n\tparent: HTMLElement;\n\targs: string\n\tconnectionUrl: string\n\n\telementSelectedTab: WsTab;\n\telementIntro: WsIntro;\n\telementToast: WsToast;\n\telementTabs: WsTabs;\n\telementCreateForm: WsDetailForm;\n\telementEditForm: WsDetailForm;\n\telementModalEditItem: WsModal;\n\telementModalCreateItem: WsModal;\n\telementWebswingRoot: HTMLElement;\n\n\n\tprivate _webswingInstance: IWebswingInstance | undefined;\n\t\n\tpublic get webswingInstance(): IWebswingInstance | undefined {\n\t\treturn this._webswingInstance;\n\t}\n\tpublic set webswingInstance(value: IWebswingInstance | undefined) {\n\t\tthis._webswingInstance = value;\n\t}\n\n\tgetServerUrl = () => {\n\t\tconst href = window.location.href;\n\t\treturn href.substring(0, href.indexOf('/migration-examples')) + '/migration-examples';\n\t}\n\n\tconstructor(el: HTMLElement) {\n\t\tthis.parent = el;\n\t\tthis.args = '';\n\t\tthis.connectionUrl = this.getServerUrl();\n\n\t\tthis.elementSelectedTab = el.querySelector('ws-tab[selected=\"true\"]') as WsTab,\n\t\tthis.elementIntro = el.querySelector('ws-intro') as WsIntro,\n\t\tthis.elementToast = el.querySelector('ws-toast') as WsToast,\n\t\tthis.elementTabs = el.querySelector('ws-tabs') as WsTabs,\n\t\tthis.elementCreateForm = el.querySelector('ws-detail-form[data-id=\"createForm\"]') as WsDetailForm,\n\t\tthis.elementEditForm = el.querySelector('ws-detail-form[data-id=\"editForm\"]') as WsDetailForm,\n\t\tthis.elementModalEditItem = el.querySelector('ws-modal[data-id=\"editRecord\"]') as WsModal,\n\t\tthis.elementModalCreateItem = el.querySelector('ws-modal[data-id=\"createRecord\"]') as WsModal,\n\t\tthis.elementWebswingRoot = el.querySelector('[data-id=\"webswing-table\"]') as HTMLElement,\n\n\t\tthis.webswingInit()\n\t\tthis.uiIntro()\n\t}\n\n\twebswingInit = (callback?: () => void) => {\n\t\tgetWebswingApi(this.connectionUrl)\n\t\t.then((api) => {\n\t\t\tthis.webswingInstance = api.bootstrap(\n\t\t\tthis.elementWebswingRoot,\n\t\t\t{\n\t\t\t\tconnectionUrl: this.connectionUrl,\n\t\t\t\tautoStart: false,\n\t\t\t\targs: this.args,\n\t\t\t\tdebugPort: Number(getParam('debugPort')),\n\t\t\t\tcompositingWindowsListener: {\n\t\t\t\t\twindowOpened: (win: IHtmlWindow) => {\n\t\t\t\t\t\tif (win.htmlWindow && win.name == \"map\" && win.element?.children.length == 0) {\n\t\t\t\t\t\t\tvar map = document.createElement(\"ws-map\");\n\t\t\t\t\t\t\tmap.style.backgroundColor = \"#dff6ff\";\n\t\t\t\t\t\t\tmap.style.border = \"1px solid #00a0db\";\n\t\t\t\t\t\t\tmap.style.display = \"block\";\n\t\t\t\t\t\t\tmap.style.width = \"100%\";\n\t\t\t\t\t\t\tmap.style.height = \"100%\";\n\t\t\t\t\t\t\twin.element.style.padding = \"0.5rem\";\n\t\t\t\t\t\t\twin.element.appendChild(map);\n\n\t\t\t\t\t\t\tmap.addEventListener('click', (e: any) => {//'regionClick', (e)=>{\n\t\t\t\t\t\t\t\tconst country = e.composedPath()[0].getAttribute('data-name');\n\t\t\t\t\t\t\t\tif (country) {\n\t\t\t\t\t\t\t\t\twin.performAction({actionName:\"filterString\",data:country})\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\twin.handleActionEvent = (evt: string | null | undefined, data: string | null | undefined) => {\n\t\t\t\t\t\t\t\tif(evt==='updateMapSelection'){\n\t\t\t\t\t\t\t\t\tdocument.querySelector('ws-map')?.setAttribute(\"active\", String(data))\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (win.htmlWindow && win.name == \"youtubeIframe\" && win.element?.children.length == 0) {\n\t\t\t\t\t\t\tvar iframe = document.createElement(\"iframe\");\n\t\t\t\t\t\t\tiframe.src = \"https://www.youtube.com/embed/rBHBlICJMcU\";\n\t\t\t\t\t\t\tiframe.width = \"100%\";\n\t\t\t\t\t\t\tiframe.height = \"400\";\n\t\t\t\t\t\t\tiframe.setAttribute(\"frameborder\", \"0\");\n\t\t\t\t\t\t\tiframe.setAttribute(\"allow\", \"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\");\n\t\t\t\t\t\t\twin.element.appendChild(iframe);\n\t\t\t\t\t\t\twin.element.style.overflow = \"hidden\";\n\t\t\t\t\t\t\twin.element.style.margin = \"10px auto\";\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\twindowOpening: (_win: IHtmlWindow) => {\n\t\t\t\t\t},\n\t\t\t\t\twindowClosing: (win: IHtmlWindow, evt: IWindowCloseEvent) => {\n\t\t\t\t\t\tif (win.name == \"youtubeIframe\") {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (win.name == \"map\") {\n\t\t\t\t\t\t\tevt.preventDefault();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\twindowClosed: (_win: IHtmlWindow) => {\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t  onReady: () => {\n\t\t\t\tthis.elementWebswingRoot.classList.add('authenticated')\n\t\t\t\tthis.webswingInstance?.start()\n\t\t\t  },\n\t\t\t  onStart: () => {\n\t\t\t\tif (callback) {\n\t\t\t\t  callback()\n\t\t\t\t}\n\t\t\t  },\n\t\t\t},\n\t\t\t(injector: IInjectorApi) => {\n\t\t\t\t// disable welcome back bar\n\t\t\t\tinjector.services.dialog!.content.continueOldSessionDialog = null;\n\t\t\t\t\n\t\t\t\tinjector.services.base!.handleActionEvent= (actionName: string, data: any) => {\n\t\t\t\t\tif (actionName==='initialize'){\n\t\t\t\t\t\tthis.webswingInstance?.performAction({actionName:\"switchStage\",data:\"3\"})\n\t\t\t\t\t}\n\t\t\t\t\tif (actionName==='clickedAddButton') {\n\t\t\t\t\t\tconst modal = this.elementModalCreateItem;\n\t\t\t\t\t\tconst form = this.elementCreateForm;\n\t\t\t\t\t\tconst toast = this.elementToast;\n\t\t\t\t\t\t\n\t\t\t\t\t\tmodal.header = 'Create Nobel prize winner record';\n\t\t\t\t\t\tmodal.show = true;\n\t\t\t\t\t\t\n\t\t\t\t\t\tif(data) {\n\t\t\t\t\t\t\tconst {categoryList, countryList} = JSON.parse(data);\n\t\t\t\t\t\t\tform.categories = categoryList;\n\t\t\t\t\t\t\tform.countries = countryList;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst modalCloseListener = (result: CustomEventInit) => {\n\t\t\t\t\t\t\tmodal.removeEventListener('close', modalCloseListener);\n\t\t\t\t\t\t\tif(result.detail === 'ok') {\n\t\t\t\t\t\t\t\tconst data = JSON.stringify(form.data)\n\t\t\t\t\t\t\t\tthis.webswingInstance?.performAction({actionName:\"createItem\",data})\n\t\t\t\t\t\t\t\ttoast.show('Record has been created sucessfuly')\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tmodal.addEventListener('close', modalCloseListener);\n\t\t\t\t\t}\n\t\t\t\t\tif (actionName==='editWinner') {\n\t\t\t\t\t\tconst modal = this.elementModalEditItem;\n\t\t\t\t\t\tconst form = this.elementEditForm;\n\t\t\t\t\t\tconst toast = this.elementToast;\n\n\t\t\t\t\t\tmodal.header = 'Edit Nobel prize winner record';\n\t\t\t\t\t\tmodal.show = true;\n\n\t\t\t\t\t\tif(data) {\n\t\t\t\t\t\t\tconst {categoryList, countryList, nobelPrizeWinner, row} = JSON.parse(data);\n\t\t\t\t\t\t\tform.categories = categoryList;\n\t\t\t\t\t\t\tform.countries = countryList;\n\t\t\t\t\t\t\tform.data = nobelPrizeWinner;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tconst modalCloseListener = (result: CustomEventInit<string>) => {\n\t\t\t\t\t\t\t\tmodal.removeEventListener('close', modalCloseListener);\n\t\t\t\t\t\t\t\tif(result.detail === 'ok') {\n\t\t\t\t\t\t\t\t\t(form.data as any)['row'] = row\n\t\t\t\t\t\t\t\t\tconst data = JSON.stringify(form.data)\n\t\t\t\t\t\t\t\t\tthis.webswingInstance?.performAction({actionName:\"editItem\",data})\n\t\t\t\t\t\t\t\t\ttoast.show('Record has been updated sucessfuly')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tmodal.addEventListener('close', modalCloseListener);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (actionName==='openWinnerTab') {\n\t\t\t\t\t\tconst nobelPrizeWinner = JSON.parse(data);\n\t\t\t\t\t\tthis.createDetailClosableTab(nobelPrizeWinner)\t\t\t\t\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t  )\n\t\t})\n\t\t.catch((e) => {\n\t\t  console.error(e)\n\t\t})\n\t}\n\n\tcreateDetailClosableTab(data: IFormData) {\n\t\tconst tab = document.createElement('ws-tab') as WsTab; \n\t\tconst wsDetailForm = document.createElement('ws-detail-form') as WsDetailForm;\n\t\tconst tabs = this.elementTabs\n\n\t\ttab.label = data.name;\n\t\tthis.elementTabs.appendChild(tab);\n\t\ttab.appendChild(wsDetailForm);\n\t\ttabs.selectTab(tab);\n\t\ttab.closable = true;\n\n\t\twsDetailForm.data = data;\n\t\twsDetailForm.readonly = true;\n\t}\n\n\tuiIntro() {\n\t\tthis.elementIntro.addEventListener('introClick', () => {\n\t\t\tconst tabs = this.elementTabs\n\t\t\tconst tableTab = this.parent.querySelectorAll('ws-tab')[1];\n\t\t\ttabs.selectTab(tableTab);\n\t\t});\n\t}\n\n}\n\nnew MigrationApp(document.body);"],"names":["MigrationApp","el","__publicField","href","callback","getWebswingApi","api","getParam","win","_a","map","e","country","evt","data","_b","iframe","_win","injector","actionName","modal","form","toast","categoryList","countryList","modalCloseListener","result","nobelPrizeWinner","row","value","tab","wsDetailForm","tabs","tableTab"],"mappings":"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"}