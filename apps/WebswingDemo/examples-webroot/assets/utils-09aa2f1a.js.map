{"version":3,"file":"utils-09aa2f1a.js","sources":["../../../node_modules/webswing-api/dist/webswing-api.js","../../../node_modules/webswing-api/dist/index.js","../../src/utils.ts"],"sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getWebswingApiFactory = exports.getWebswingApi = void 0;\r\nconst inProgress = new Map();\r\nconst randomPrefix = (Math.random() + 1).toString(36).substring(7);\r\nconst globalApiRegister = self['__webswing_api_module__'] = self['__webswing_api_module__'] || { api: {} };\r\nconst apiRegister = globalApiRegister.api = globalApiRegister[\"api\"] || {};\r\nfunction getWebswingApi(connectionUrl, i18n) {\r\n    return getWebswingApiFactory(connectionUrl).then(factory => {\r\n        return factory.createWebswingApi(i18n);\r\n    });\r\n}\r\nexports.getWebswingApi = getWebswingApi;\r\nfunction getWebswingApiFactory(connectionUrl) {\r\n    connectionUrl = withTrailingSlash(connectionUrl);\r\n    return loadVersion(connectionUrl).then(version => {\r\n        if (!apiRegister[version]) {\r\n            return new Promise((resolve, reject) => {\r\n                const url = connectionUrl + 'javascript/webswing-embed.js?version=' + version;\r\n                loadScript(url, (event) => {\r\n                    if (isEvent(event)) {\r\n                        if (event.type === 'error') {\r\n                            reject(\"Failed to load script at \" + url);\r\n                        }\r\n                        else if (!apiRegister[version]) {\r\n                            reject(\"Failed to load webswingApi due to unexpected or missing version. Expected version[\" + version + \"], loaded versions [\" + Object.keys(apiRegister).join(',') + \"]\");\r\n                        }\r\n                        else {\r\n                            resolve(apiRegister[version](connectionUrl));\r\n                        }\r\n                    }\r\n                    else {\r\n                        reject(\"Failed to load \" + connectionUrl + '/javascript/webswing-embed.js due to ' + event);\r\n                    }\r\n                }, version);\r\n            });\r\n        }\r\n        else {\r\n            return apiRegister[version](connectionUrl);\r\n        }\r\n    });\r\n}\r\nexports.getWebswingApiFactory = getWebswingApiFactory;\r\nfunction withTrailingSlash(url) {\r\n    return !url.endsWith('/') ? url + '/' : url;\r\n}\r\nfunction loadVersion(connectionUrl) {\r\n    var url = connectionUrl + \"rest/version\";\r\n    return fetch(url).then((val) => {\r\n        return val.text();\r\n    }).catch(reason => {\r\n        console.error(\"Failed to resolve version from url \" + url);\r\n        return 'undefined';\r\n    });\r\n}\r\nfunction isEvent(eventOrString) {\r\n    return eventOrString.type !== undefined;\r\n}\r\nconst loadScript = (url, done, key) => {\r\n    const inProgressUrl = inProgress.get(url);\r\n    if (inProgressUrl != undefined) {\r\n        inProgressUrl.push(done);\r\n        return;\r\n    }\r\n    let script;\r\n    let needAttach = false;\r\n    if (key !== undefined) {\r\n        let scripts = document.getElementsByTagName(\"script\");\r\n        for (let i = 0; i < scripts.length; i++) {\r\n            let s = scripts[i];\r\n            if (s.getAttribute(\"src\") == url || s.getAttribute(\"data-webswing-script\") == randomPrefix + key) {\r\n                script = s;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    if (!script) {\r\n        needAttach = true;\r\n        script = document.createElement('script');\r\n        script.setAttribute(\"data-webswing-script\", randomPrefix + key);\r\n        script.src = url;\r\n    }\r\n    inProgress.set(url, [done]);\r\n    var onScriptComplete = (prev, event) => {\r\n        if (script) {\r\n            script.onerror = script.onload = null;\r\n            clearTimeout(timeout);\r\n            var doneFns = inProgress.get(url);\r\n            inProgress.delete(url);\r\n            script.parentNode && script.parentNode.removeChild(script);\r\n            doneFns && doneFns.forEach((fn) => (fn(event)));\r\n            if (prev)\r\n                return prev.apply(script, event);\r\n        }\r\n    };\r\n    var timeout = setTimeout(onScriptComplete.bind(script, null, 'timeout'), 120000);\r\n    script.onerror = onScriptComplete.bind(script, script.onerror);\r\n    script.onload = onScriptComplete.bind(script, script.onload);\r\n    needAttach && document.head.appendChild(script);\r\n};\r\n","\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getWebswingApiFactory = exports.getWebswingApi = void 0;\r\nvar webswing_api_1 = require(\"./webswing-api\");\r\nObject.defineProperty(exports, \"getWebswingApi\", { enumerable: true, get: function () { return webswing_api_1.getWebswingApi; } });\r\nObject.defineProperty(exports, \"getWebswingApiFactory\", { enumerable: true, get: function () { return webswing_api_1.getWebswingApiFactory; } });\r\n","export const getParam = (name: string) => {\n\tname = name.replace(/[\\[]/, \"\\\\\\[\").replace(/[\\]]/, \"\\\\\\]\");\n\tvar results = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\").exec(location.href);\n\treturn results == null ? null : decodeURIComponent(results[1]);\n}"],"names":["webswingApi","inProgress","randomPrefix","globalApiRegister","apiRegister","getWebswingApi","connectionUrl","i18n","getWebswingApiFactory","factory","withTrailingSlash","loadVersion","version","resolve","reject","url","loadScript","event","isEvent","val","reason","eventOrString","done","key","inProgressUrl","script","needAttach","scripts","i","s","onScriptComplete","prev","timeout","doneFns","fn","exports","webswing_api_1","require$$0","getParam","name","results"],"mappings":"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"}